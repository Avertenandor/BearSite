<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>PLEX ONE Marathon - Криптомарафон с токеном PLEX ONE | Binance Smart Chain</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="PLEX ONE Marathon - уникальный криптомарафон на Binance Smart Chain. Участвуйте в 730-дневном марафоне с токеном PLEX ONE. Авторизация 1 PLEX ONE, старт 7 PLEX ONE. Контракт: 0xdf179b6cAdBC61FFD86A3D2e55f6d6e083ade6c1">
  <meta name="keywords" content="PLEX ONE, PLEX, криптомарафон, Binance Smart Chain, BSC, токен, марафон, криптовалюта, блокчейн, децентрализованные финансы, DeFi">
  <meta name="author" content="PLEX ONE Marathon">
  <meta name="robots" content="index, follow">
  <meta name="language" content="Russian">
  <meta name="revisit-after" content="1 days">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://plexmarathon.com/">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://plexmarathon.com/">
  <meta property="og:title" content="PLEX ONE Marathon - Криптомарафон с токеном PLEX ONE">
  <meta property="og:description" content="Уникальный 730-дневный криптомарафон на Binance Smart Chain. Участвуйте в марафоне с токеном PLEX ONE. Авторизация 1 PLEX ONE, старт 7 PLEX ONE.">
  <meta property="og:image" content="https://plexmarathon.com/images/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="ru_RU">
  <meta property="og:site_name" content="PLEX ONE Marathon">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://plexmarathon.com/">
  <meta property="twitter:title" content="PLEX ONE Marathon - Криптомарафон с токеном PLEX ONE">
  <meta property="twitter:description" content="Уникальный 730-дневный криптомарафон на Binance Smart Chain. Участвуйте в марафоне с токеном PLEX ONE.">
  <meta property="twitter:image" content="https://plexmarathon.com/images/twitter-image.png">
  
  <!-- Schema.org structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "PLEX ONE Marathon",
    "description": "Криптомарафон с токеном PLEX ONE на Binance Smart Chain",
    "url": "https://plexmarathon.com/",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Web Browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "author": {
      "@type": "Organization",
      "name": "PLEX ONE Marathon"
    },
    "keywords": "PLEX ONE, криптомарафон, Binance Smart Chain, токен, DeFi"
  }
  </script>
  
  <!-- Криптовалютная микроразметка -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "PLEX ONE Token",
    "description": "Криптовалюта PLEX ONE на Binance Smart Chain",
    "brand": {
      "@type": "Brand",
      "name": "PLEX ONE"
    },
    "category": "Cryptocurrency",
    "additionalProperty": [
      {
        "@type": "PropertyValue",
        "name": "Contract Address",
        "value": "0xdf179b6cAdBC61FFD86A3D2e55f6d6e083ade6c1"
      },
      {
        "@type": "PropertyValue",
        "name": "Blockchain",
        "value": "Binance Smart Chain"
      },
      {
        "@type": "PropertyValue",
        "name": "Symbol",
        "value": "PLEX"
      },
      {
        "@type": "PropertyValue",
        "name": "Decimals",
        "value": "9"
      },
      {
        "@type": "PropertyValue",
        "name": "Total Supply",
        "value": "12600000"
      }
    ]
  }
  </script>
  
  <!-- Микроразметка для организации -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "PLEX ONE Marathon",
    "url": "https://plexmarathon.com/",
    "logo": "https://plexmarathon.com/favicon.svg",
    "description": "Криптомарафон с токеном PLEX ONE на Binance Smart Chain",
    "sameAs": [
      "https://bscscan.com/address/0xdf179b6cAdBC61FFD86A3D2e55f6d6e083ade6c1"
    ]
  }
  </script>
  
  <!-- Дополнительные мета-теги для криптовалют -->
  <meta name="cryptocurrency" content="PLEX ONE">
  <meta name="blockchain" content="Binance Smart Chain">
  <meta name="contract-address" content="0xdf179b6cAdBC61FFD86A3D2e55f6d6e083ade6c1">
  <meta name="token-symbol" content="PLEX">
  <meta name="token-decimals" content="9">
  <meta name="total-supply" content="12600000">
  
  <!-- Дополнительные SEO мета-теги -->
  <meta name="geo.region" content="RU">
  <meta name="geo.placename" content="Russia">
  <meta name="distribution" content="global">
  <meta name="rating" content="general">
  <meta name="coverage" content="worldwide">
  <meta name="target" content="all">
  <meta name="HandheldFriendly" content="true">
  <meta name="MobileOptimized" content="width">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="PLEX Marathon">
  <meta name="msapplication-TileColor" content="#3b82f6">
  <meta name="msapplication-config" content="/browserconfig.xml">
  
  <!-- Предзагрузка критических ресурсов -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://api.bscscan.com">
  <link rel="dns-prefetch" href="https://api.bscscan.com">
  <link rel="dns-prefetch" href="https://bscscan.com">
  
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-color: #3b82f6;
      --primary-hover: #2563eb;
      --warning-color: #f59e0b;
      --warning-hover: #d97706;
      --error-color: #ef4444;
      --error-hover: #dc2626;
      --success-color: #10b981;
      --background-dark: #111827;
      --container-bg: #1f2937;
      --input-bg: #374151;
      --text-light: #f3f4f6;
      --text-muted: #9ca3af;
      --border-color: #4b5563;
    }
    
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* Улучшения для touch-устройств */
    button, input, .rules-header {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    /* Улучшения для мобильных браузеров */
    input[type="text"] {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      border-radius: 8px;
    }
    
    /* Улучшения для iOS Safari */
    @supports (-webkit-touch-callout: none) {
      body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      button {
        -webkit-appearance: none;
        border-radius: 8px;
      }
    }
    
    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: var(--text-light);
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }
    
    h1 {
      margin-bottom: 20px;
      font-weight: 700;
      color: white;
      font-size: 2.2rem;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
      text-align: center;
    }
    
    h2 {
      color: white;
      margin-top: 0;
      font-size: 1.5rem;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
    }
    
    h3 {
      color: white;
      font-size: 1.2rem;
    }
    
    .container {
      background: var(--container-bg);
      padding: 24px;
      border-radius: 12px;
      max-width: 600px;
      width: 100%;
      margin-bottom: 20px;
      display: none;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .active {
      display: block;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 16px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--input-bg);
      color: var(--text-light);
      font-size: 1rem;
      transition: all 0.3s ease;
      outline: none;
      min-height: 44px;
      touch-action: manipulation;
    }
    
    /* Улучшения для мобильных input */
    input[type="text"]:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
      transform: translateY(-1px);
    }
    
    /* Убираем увеличение на iOS */
    @media screen and (max-width: 768px) {
      input[type="text"] {
        font-size: 16px;
      }
    }
    
    input[type="text"]:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
    }
    
    button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 10px;
      font-weight: 500;
      transition: all 0.2s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      min-height: 44px;
      touch-action: manipulation;
      position: relative;
      overflow: hidden;
    }
    
    /* Эффект нажатия для мобильных устройств */
    button:active {
      transform: translateY(1px);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    /* Улучшенный hover эффект */
    @media (hover: hover) {
      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      }
    }
    
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    button:active {
      transform: translateY(1px);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-hover);
    }
    
    .btn-warning {
      background: var(--warning-color);
      color: #000;
    }
    
    .btn-warning:hover {
      background: var(--warning-hover);
    }
    
    .btn-error {
      background: var(--error-color);
      color: white;
    }
    
    .btn-error:hover {
      background: var(--error-hover);
    }
    
    #notification {
      margin-top: 16px;
      background: var(--container-bg);
      padding: 16px;
      border-left: 4px solid var(--border-color);
      display: none;
      max-width: 600px;
      width: 100%;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      font-weight: 500;
      animation: fadeIn 0.3s ease;
      position: relative;
      z-index: 1000;
    }
    
    /* Мобильные уведомления */
    @media (max-width: 768px) {
      #notification {
        position: fixed;
        top: 20px;
        left: 10px;
        right: 10px;
        max-width: none;
        margin-top: 0;
        z-index: 9999;
        animation: slideDown 0.3s ease;
      }
    }
    
    @keyframes slideDown {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .notif-success {
      border-left-color: var(--success-color);
      background: rgba(16, 185, 129, 0.1);
    }
    
    .notif-error {
      border-left-color: var(--error-color);
      background: rgba(239, 68, 68, 0.1);
    }
    
    .notif-info {
      border-left-color: var(--primary-color);
      background: rgba(59, 130, 246, 0.1);
    }
    
    .flow-item {
      border: 1px solid var(--border-color);
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.03);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    /* Улучшения для мобильных flow-элементов */
    @media (max-width: 768px) {
      .flow-item {
        padding: 12px;
        margin-bottom: 12px;
      }
      
      .flow-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, var(--primary-color), var(--warning-color));
        opacity: 0.7;
      }
    }
    
    .flow-item:hover {
      background: rgba(255, 255, 255, 0.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .qr-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    
    .qr-container img {
      max-width: 180px;
      border: 8px solid white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }
    
    /* Улучшения для мобильного QR-кода */
    @media (max-width: 768px) {
      .qr-container img {
        max-width: 150px;
        border: 6px solid white;
        border-radius: 10px;
      }
    }
    
    @media (max-width: 480px) {
      .qr-container img {
        max-width: 120px;
        border: 4px solid white;
        border-radius: 8px;
      }
    }
    
    /* Эффект при нажатии на QR-код */
    .qr-container img:active {
      transform: scale(0.95);
    }
    
    #authDetails {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      border: 1px solid var(--border-color);
    }
    
    #systemWalletEl {
      background: var(--input-bg);
      padding: 12px;
      border-radius: 8px;
      word-wrap: break-word;
      font-weight: bold;
      border: 1px dashed var(--border-color);
      font-family: monospace;
      font-size: 0.9rem;
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    #systemWalletEl:hover {
      border-color: var(--primary-color);
      background: rgba(59, 130, 246, 0.1);
    }
    
    #systemWalletEl:active {
      transform: scale(0.98);
    }
    
    /* Улучшения для мобильных устройств */
    @media (max-width: 768px) {
      #systemWalletEl {
        padding: 10px;
        font-size: 0.8rem;
        min-height: 44px;
        display: flex;
        align-items: center;
      }
    }
    
    @media (max-width: 480px) {
      #systemWalletEl {
        padding: 8px;
        font-size: 0.75rem;
      }
    }
    
    #scanStatus {
      padding: 15px;
      border-radius: 8px;
      background: rgba(59, 130, 246, 0.1);
      margin-bottom: 20px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    
    /* Улучшения для мобильного scan status */
    @media (max-width: 768px) {
      #scanStatus {
        padding: 12px;
        margin-bottom: 15px;
        flex-direction: column;
        gap: 8px;
      }
      
      #scanStatus::before {
        position: static;
        margin: 0;
      }
    }
    
    @media (max-width: 480px) {
      #scanStatus {
        padding: 10px;
        margin-bottom: 12px;
        font-size: 0.85rem;
      }
    }
    
    #scanStatus::before {
      content: "";
      width: 20px;
      height: 20px;
      border: 3px solid rgba(59, 130, 246, 0.3);
      border-top: 3px solid var(--primary-color);
      border-radius: 50%;
      margin-right: 12px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    #progressSection {
      padding: 20px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 8px;
      border: 1px solid var(--border-color);
      position: relative;
    }
    
    /* Улучшения для мобильного progress section */
    @media (max-width: 768px) {
      #progressSection {
        padding: 16px;
      }
      
      #progressSection p {
        margin-bottom: 12px;
        font-size: 0.9rem;
      }
    }
    
    @media (max-width: 480px) {
      #progressSection {
        padding: 12px;
      }
      
      #progressSection p {
        margin-bottom: 10px;
        font-size: 0.85rem;
      }
    }
    
    #finalMessage {
      background: var(--success-color);
      color: white;
      padding: 16px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      animation: pulseSuccess 2s infinite;
      position: relative;
      overflow: hidden;
    }
    
    /* Улучшения для мобильного final message */
    @media (max-width: 768px) {
      #finalMessage {
        padding: 12px;
        font-size: 0.9rem;
      }
      
      #finalMessage p {
        margin: 0;
      }
    }
    
    @media (max-width: 480px) {
      #finalMessage {
        padding: 10px;
        font-size: 0.85rem;
      }
    }
    
    @keyframes pulseSuccess {
      0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5); }
      70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
      100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
    }
    
    .tx-hash {
      font-family: monospace;
      font-size: 0.85rem;
      background: rgba(0, 0, 0, 0.2);
      padding: 4px 8px;
      border-radius: 4px;
      margin-top: 4px;
      word-break: break-all;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
      min-height: 32px;
      display: flex;
      align-items: center;
    }
    
    /* Улучшения для мобильных tx-hash */
    @media (max-width: 768px) {
      .tx-hash {
        font-size: 0.75rem;
        padding: 6px 8px;
        min-height: 36px;
        margin-top: 6px;
      }
    }
    
    @media (max-width: 480px) {
      .tx-hash {
        font-size: 0.7rem;
        padding: 4px 6px;
        min-height: 32px;
        margin-top: 4px;
      }
    }
    
    .tx-hash:hover {
      background: rgba(0, 0, 0, 0.3);
    }
    
    .tx-hash-container {
      margin-top: 8px;
      max-height: 120px;
      overflow-y: auto;
      border-left: 3px solid var(--primary-color);
      padding-left: 10px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: var(--primary-color) transparent;
    }
    
    /* Стилизация скроллбара для WebKit браузеров */
    .tx-hash-container::-webkit-scrollbar {
      width: 6px;
    }
    
    .tx-hash-container::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .tx-hash-container::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 3px;
    }
    
    .tx-hash-container::-webkit-scrollbar-thumb:hover {
      background: var(--primary-hover);
    }
    
    /* Мобильная адаптация */
    @media (max-width: 768px) {
      body { 
        padding: 10px; 
        font-size: 14px;
      }
      
      h1 {
        font-size: 1.8rem;
        margin-bottom: 15px;
      }
      
      h2 {
        font-size: 1.3rem;
      }
      
      h3 {
        font-size: 1.1rem;
      }
      
      .container { 
        padding: 16px; 
        margin-bottom: 15px;
      }
      
      button { 
        width: 100%; 
        padding: 14px 20px;
        font-size: 1rem;
        margin-top: 12px;
      }
      
      input[type="text"] {
        padding: 14px 16px;
        font-size: 1rem;
        margin-bottom: 12px;
      }
      
      .ticker-container {
        padding: 6px;
        margin-bottom: 15px;
      }
      
      .ticker span {
        font-size: 0.9rem;
      }
      
      .rules-header {
        padding: 12px 16px;
      }
      
      .rules-header h2 {
        font-size: 1.2rem;
      }
      
      .rules-content.show {
        padding: 16px;
      }
      
      .rules-section {
        padding: 12px;
        margin: 12px 0;
      }
      
      .rules-section h3 {
        font-size: 1rem;
      }
      
      .rules-content ul, .rules-content ol {
        padding-left: 16px;
      }
      
      .rules-content li {
        margin-bottom: 6px;
        font-size: 0.9rem;
      }
      
      .flow-item {
        padding: 12px;
        margin-bottom: 12px;
      }
      
      .qr-container img {
        max-width: 150px;
        border: 6px solid white;
      }
      
      #systemWalletEl {
        font-size: 0.8rem;
        padding: 10px;
      }
      
      .tx-hash {
        font-size: 0.75rem;
        padding: 3px 6px;
      }
      
      .tx-hash-container {
        max-height: 100px;
      }
      
      #notification {
        margin-top: 12px;
        padding: 12px;
        font-size: 0.9rem;
      }
      
      #scanStatus {
        padding: 12px;
        font-size: 0.9rem;
      }
      
      #scanStatus::before {
        width: 16px;
        height: 16px;
        margin-right: 8px;
      }
      
      #progressSection {
        padding: 16px;
      }
      
      #finalMessage {
        padding: 12px;
        font-size: 0.9rem;
      }
    }
    
    @media (max-width: 480px) {
      body { 
        padding: 8px; 
        font-size: 13px;
      }
      
      h1 {
        font-size: 1.6rem;
        margin-bottom: 12px;
      }
      
      h2 {
        font-size: 1.2rem;
      }
      
      .container { 
        padding: 12px; 
        margin-bottom: 12px;
        border-radius: 8px;
      }
      
      button { 
        padding: 12px 16px;
        font-size: 0.95rem;
        margin-top: 10px;
      }
      
      input[type="text"] {
        padding: 12px 14px;
        font-size: 0.95rem;
        margin-bottom: 10px;
      }
      
      .ticker-container {
        padding: 4px;
        margin-bottom: 12px;
      }
      
      .ticker span {
        font-size: 0.85rem;
      }
      
      .rules-header {
        padding: 10px 12px;
      }
      
      .rules-header h2 {
        font-size: 1.1rem;
      }
      
      .rules-content.show {
        padding: 12px;
      }
      
      .rules-section {
        padding: 10px;
        margin: 10px 0;
      }
      
      .rules-content li {
        font-size: 0.85rem;
      }
      
      .flow-item {
        padding: 10px;
        margin-bottom: 10px;
      }
      
      .qr-container img {
        max-width: 120px;
        border: 4px solid white;
      }
      
      #systemWalletEl {
        font-size: 0.75rem;
        padding: 8px;
      }
      
      .tx-hash {
        font-size: 0.7rem;
        padding: 2px 4px;
      }
      
      #notification {
        padding: 10px;
        font-size: 0.85rem;
      }
      
      #scanStatus {
        padding: 10px;
        font-size: 0.85rem;
      }
      
      #progressSection {
        padding: 12px;
      }
      
      #finalMessage {
        padding: 10px;
        font-size: 0.85rem;
      }
    }
    
    @media (max-width: 360px) {
      body { 
        padding: 6px; 
        font-size: 12px;
      }
      
      h1 {
        font-size: 1.4rem;
        margin-bottom: 10px;
      }
      
      h2 {
        font-size: 1.1rem;
      }
      
      .container { 
        padding: 10px; 
        margin-bottom: 10px;
      }
      
      button { 
        padding: 10px 14px;
        font-size: 0.9rem;
      }
      
      input[type="text"] {
        padding: 10px 12px;
        font-size: 0.9rem;
      }
      
      .ticker span {
        font-size: 0.8rem;
      }
      
      .rules-header h2 {
        font-size: 1rem;
      }
      
      .rules-content.show {
        padding: 10px;
      }
      
      .rules-section {
        padding: 8px;
        margin: 8px 0;
      }
      
      .rules-content li {
        font-size: 0.8rem;
      }
      
      .flow-item {
        padding: 8px;
        margin-bottom: 8px;
      }
      
      .qr-container img {
        max-width: 100px;
      }
      
      #systemWalletEl {
        font-size: 0.7rem;
        padding: 6px;
      }
      
      .tx-hash {
        font-size: 0.65rem;
      }
      
      #notification {
        padding: 8px;
        font-size: 0.8rem;
      }
      
      #scanStatus {
        padding: 8px;
        font-size: 0.8rem;
      }
      
      #progressSection {
        padding: 10px;
      }
      
      #finalMessage {
        padding: 8px;
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>PLEX ONE Marathon</h1>
  </header>
  <div class="ticker-container">
    <div class="ticker">
      <span>На время тестов мониторинговой системы сайта остальные 16 разделов сайта отключены!</span>
    </div>
  </div>

  <style>
    .ticker-container {
      max-width: 600px;
      width: 100%;
      background: rgba(37, 99, 235, 0.15);
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 20px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
    }
    
    .ticker {
      white-space: nowrap;
      animation: ticker 20s linear infinite;
      display: inline-block;
      will-change: transform;
    }
    
    /* Пауза анимации при наведении на десктопе */
    @media (hover: hover) {
      .ticker:hover {
        animation-play-state: paused;
      }
    }
    
    /* Улучшения для мобильных устройств */
    @media (max-width: 768px) {
      .ticker {
        animation-duration: 15s;
      }
    }
    
    @media (max-width: 480px) {
      .ticker {
        animation-duration: 12s;
      }
    }
    
    .ticker span {
      color: #f3f4f6;
      font-weight: 500;
      font-size: 1rem;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      padding-left: 100%;
    }
    
    @keyframes ticker {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-100%);
      }
    }
  </style>
  
  <main>
    <section class="rules-container">
      <div class="rules-header" onclick="toggleRules()">
        <h2>Правила марафона <span id="rulesToggle">▼</span></h2>
      </div>
    <div id="rulesContent" class="rules-content">
      <p>Отправляя на кошелек системы 7 монет PLEX ONE вы включаете марафон для себя. Система марафон начинает мониторинг вашего кошелька и всех его действий.</p>
      
      <div class="rules-section">
        <h3>Участие в потоках</h3>
        <ul>
          <li><span class="amount">30 монет PLEX ONE</span> = участие в тестовом уровне (остальные уровни доступны только для участников которые отправят более 10 раз по 30 монет)</li>
          <li><span class="amount">100 монет PLEX ONE</span> = участие в первом потоке</li>
          <li><span class="amount">200 монет PLEX ONE</span> = участие в втором потоке</li>
          <li><span class="amount">300 монет PLEX ONE</span> = участие в третьем потоке</li>
          <li><span class="amount">400 монет PLEX ONE</span> = участие в четвертом потоке</li>
          <li><span class="amount">500 монет PLEX ONE</span> = участие в пятом потоке</li>
        </ul>
      </div>
      
      <p>Марафон это 730 ваших шагов по одному шагу каждый день. Только вам решать какими шагами вы поедете к своим наградам большими или маленькими или средними в любом случае это ваш выбор и мы его уважаем.</p>
      
      <div class="rules-section">
        <h3>Типы выплат</h3>
        <ol>
          <li>Выплата ежедневная в BnB, это небольшая ежедневная выплата за ваше участие.</li>
          <li>Выплата раз в 15 дней в BnB, это выплата которая будет то повышаться то снижаться на протяжении всего Марафона и начнет сильно увеличиваться с 200 того шага.</li>
          <li>Выплата бонуса за ежедневный вход - ваша авторизация платная и стоит 1 монету мы собираем эти монеты в банк при росте курса разбавляем банк разными монетами которые мы покупаем на эти деньги и разыгрываем среди всех наших участников эти монеты как призы.</li>
          <li>Еженедельная выплата по розыгрышу, проводится по субботам мы разыгрываем 7% от недельной выручки, в призах могут быть довольно высокие награды или дорогие монеты.</li>
          <li>Карусель розыгрыша за 5 монет PLEX ONE запускает механизм карусели в которой пользователь может выиграть до 10 000 долл.</li>
          <li>Выплаты по партнерским программам 5% на каждом из 3 уровней реферально/партнерской программы.</li>
          <li>Выплаты за снижение курса, такой инструмент как марафон довольно быстро и ощутимо разгоняет курс монеты. Этот процесс заставляет нас при повышении курса выше определенных рубежей продавать часть монеты Марафона и выплачивать всем участникам Марафона сообразно их движениям в потоках.</li>
          <li>Игра разбивание шаров и извлечение разных монет в случае победы. Игра может принести до 1000 долларов если повезет.</li>
        </ol>
      </div>
      
      <p class="conclusion">Марафон инструмент построен логически и сформирован как инструмент широким кругом участников нашего сообщества. Он получился простым для понимания, интересным по доходности, предсказуемым и стабильным.</p>
    </div>
  </div>

  <style>
    .rules-container {
      background: var(--container-bg);
      border-radius: 12px;
      max-width: 600px;
      width: 100%;
      margin: 0 auto 20px auto;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.05);
      overflow: hidden;
    }
    
    .rules-header {
      padding: 16px 20px;
      cursor: pointer;
      background: linear-gradient(90deg, rgba(59,130,246,0.1) 0%, rgba(59,130,246,0.2) 100%);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      transition: all 0.3s ease;
    }
    
    .rules-header:hover {
      background: linear-gradient(90deg, rgba(59,130,246,0.2) 0%, rgba(59,130,246,0.3) 100%);
    }
    
    .rules-header h2 {
      margin: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.3rem;
      border-bottom: none;
      padding-bottom: 0;
      min-height: 44px;
    }
    
    /* Улучшения для мобильных правил */
    @media (max-width: 768px) {
      .rules-header h2 {
        font-size: 1.2rem;
        min-height: 40px;
      }
      
      #rulesToggle {
        font-size: 0.9rem;
        min-width: 20px;
        text-align: center;
      }
    }
    
    @media (max-width: 480px) {
      .rules-header h2 {
        font-size: 1.1rem;
        min-height: 36px;
      }
      
      #rulesToggle {
        font-size: 0.8rem;
        min-width: 18px;
      }
    }
    
    .rules-content {
      padding: 0 20px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease, padding 0.5s ease;
    }
    
    .rules-content.show {
      padding: 20px;
      max-height: 3000px;
    }
    
    .rules-section {
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      border-left: 3px solid var(--primary-color);
    }
    
    .rules-section h3 {
      margin-top: 0;
      color: var(--primary-color);
      font-size: 1.1rem;
    }
    
    .amount {
      font-weight: bold;
      color: var(--warning-color);
    }
    
    .rules-content ul, .rules-content ol {
      padding-left: 20px;
    }
    
    .rules-content li {
      margin-bottom: 8px;
    }
    
    .conclusion {
      font-style: italic;
      border-top: 1px solid var(--border-color);
      padding-top: 15px;
      margin-top: 20px;
    }
    
    #rulesToggle {
      font-size: 0.8rem;
      transition: transform 0.3s ease;
    }
  </style>
  
  <script>
    function toggleRules() {
      const content = document.getElementById('rulesContent');
      const toggle = document.getElementById('rulesToggle');
      content.classList.toggle('show');
      toggle.textContent = content.classList.contains('show') ? '▲' : '▼';
      toggle.style.transform = content.classList.contains('show') ? 'rotate(0deg)' : 'rotate(0deg)';
    }
  </script></div>

    </section>
  </main>

  <!-- 1) Экран авторизации -->
  <section id="screenAuth" class="container">
    <h2>Авторизация: отправьте 1 PLEX ONE</h2>
    <p>Введите <b>ваш</b> BSC-адрес (откуда будете отправлять), затем «Показать реквизиты»:</p>
    <input type="text" id="userWalletInput" placeholder="0x..." />
    <button id="showDetailsBtn" class="btn-primary">Показать реквизиты</button>

    <div id="authDetails" style="display:none;">
      <p>Отправьте <b>1 PLEX ONE</b> на кошелёк системы:</p>
      <p id="systemWalletEl"></p>
      <div class="qr-container" id="qrCodeWrap"></div>

      <button id="iPaidBtn" class="btn-warning" style="margin-top:10px;">Я оплатил 1 PLEX ONE</button>
      <p style="font-size:0.9em; color:#9ca3af; margin-top:6px;">(У вас есть 5 минут после нажатия, чтобы транзакция попала в интервал)</p>
      
      <div id="authHashContainer" class="tx-hash-container" style="display:none;">
        <p><b>Хеш транзакции авторизации:</b></p>
        <div id="authHash" class="tx-hash"></div>
      </div>
    </div>
  </div>

  </section>

  <!-- 2) Экран марафона -->
  <section id="screenMarathon" class="container">
    <h2>Статус Марафона</h2>
    <div id="scanStatus">Сканируем транзакции… Пожалуйста, подождите.</div>

    <div id="progressSection" style="display:none;">
      <p><b>Старт (7 PLEX ONE):</b> <span id="startStatus">—</span></p>
      <div id="startHashContainer" class="tx-hash-container" style="display:none;">
        <p><b>Хеш транзакции старта:</b></p>
        <div id="startHash" class="tx-hash"></div>
      </div>
      
      <p><b>Тест (10×30 PLEX ONE):</b> <span id="testFlowEl">0</span> / 10</p>
      <div id="testHashContainer" class="tx-hash-container" style="display:none;">
        <p><b>Хеши транзакций теста:</b></p>
        <div id="testHashes"></div>
      </div>

      <div id="flowsSection" style="margin-top:14px; display:none;">
        <h3>5 потоков (730 оплат, 1 в сутки)</h3>
        <div class="flow-item">
          Поток #1 (100 PLEX ONE): <span id="flow1Count">0</span> / 730  
          <br>Последняя оплата: <span id="flow1Date">—</span>
          <div id="flow1HashContainer" class="tx-hash-container" style="display:none;">
            <p><b>Последний хеш:</b></p>
            <div id="flow1Hash" class="tx-hash"></div>
          </div>
        </div>
        <div class="flow-item">
          Поток #2 (200 PLEX ONE): <span id="flow2Count">0</span> / 730  
          <br>Последняя оплата: <span id="flow2Date">—</span>
          <div id="flow2HashContainer" class="tx-hash-container" style="display:none;">
            <p><b>Последний хеш:</b></p>
            <div id="flow2Hash" class="tx-hash"></div>
          </div>
        </div>
        <div class="flow-item">
          Поток #3 (300 PLEX ONE): <span id="flow3Count">0</span> / 730  
          <br>Последняя оплата: <span id="flow3Date">—</span>
          <div id="flow3HashContainer" class="tx-hash-container" style="display:none;">
            <p><b>Последний хеш:</b></p>
            <div id="flow3Hash" class="tx-hash"></div>
          </div>
        </div>
        <div class="flow-item">
          Поток #4 (400 PLEX ONE): <span id="flow4Count">0</span> / 730  
          <br>Последняя оплата: <span id="flow4Date">—</span>
          <div id="flow4HashContainer" class="tx-hash-container" style="display:none;">
            <p><b>Последний хеш:</b></p>
            <div id="flow4Hash" class="tx-hash"></div>
          </div>
        </div>
        <div class="flow-item">
          Поток #5 (500 PLEX ONE): <span id="flow5Count">0</span> / 730  
          <br>Последняя оплата: <span id="flow5Date">—</span>
          <div id="flow5HashContainer" class="tx-hash-container" style="display:none;">
            <p><b>Последний хеш:</b></p>
            <div id="flow5Hash" class="tx-hash"></div>
          </div>
        </div>
      </div>

      <div id="finalMessage" style="margin-top:12px; display:none;">
        <p>Поздравляем! Все этапы пройдены!</p>
      </div>
    </div>

    <button id="rescanBtn" class="btn-warning" style="margin-top:10px; display:none;">Пересканировать</button>
    <button id="resetBtn" class="btn-error" style="margin-top:10px;">Сбросить</button>
  </div>

  </section>

  <!-- Уведомления -->
  <aside id="notification"></aside>

  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>PLEX ONE Token</h3>
        <p><strong>Контракт:</strong> <code>0xdf179b6cAdBC61FFD86A3D2e55f6d6e083ade6c1</code></p>
        <p><strong>Сеть:</strong> Binance Smart Chain (BSC)</p>
        <p><strong>Символ:</strong> PLEX</p>
        <p><strong>Decimals:</strong> 9</p>
        <p><strong>Total Supply:</strong> 12,600,000 PLEX</p>
      </div>
      <div class="footer-section">
        <h3>Полезные ссылки</h3>
        <ul>
          <li><a href="https://bscscan.com/address/0xdf179b6cAdBC61FFD86A3D2e55f6d6e083ade6c1" target="_blank" rel="noopener">BSCScan - Контракт</a></li>
          <li><a href="https://pancakeswap.finance/swap?outputCurrency=0xdf179b6cAdBC61FFD86A3D2e55f6d6e083ade6c1" target="_blank" rel="noopener">PancakeSwap - Купить</a></li>
          <li><a href="https://www.geckoterminal.com/ru/bsc/pools/0x41d9650faf3341cbf8947fd8063a1fc88dbf1889" target="_blank" rel="noopener">GeckoTerminal - График</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Марафон</h3>
        <ul>
          <li>Авторизация: 1 PLEX ONE</li>
          <li>Старт: 7 PLEX ONE</li>
          <li>Тест: 30 PLEX ONE (10 раз)</li>
          <li>Потоки: 100-500 PLEX ONE</li>
          <li>Длительность: 730 дней</li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 PLEX ONE Marathon. Все права защищены.</p>
    </div>
  </footer>

  <style>
    footer {
      background: var(--container-bg);
      border-radius: 12px;
      max-width: 600px;
      width: 100%;
      margin: 20px auto;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .footer-content {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .footer-section h3 {
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: 1.1rem;
    }
    
    .footer-section p {
      margin: 5px 0;
      font-size: 0.9rem;
    }
    
    .footer-section ul {
      list-style: none;
      padding: 0;
    }
    
    .footer-section li {
      margin: 5px 0;
      font-size: 0.9rem;
    }
    
    .footer-section a {
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .footer-section a:hover {
      text-decoration: underline;
    }
    
    .footer-section code {
      background: var(--input-bg);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.8rem;
      word-break: break-all;
    }
    
    .footer-bottom {
      border-top: 1px solid var(--border-color);
      padding-top: 15px;
      margin-top: 15px;
      text-align: center;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    
    @media (min-width: 768px) {
      .footer-content {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 767px) {
      footer {
        padding: 16px;
        margin: 15px auto;
      }
      
      .footer-content {
        gap: 16px;
      }
      
      .footer-section h3 {
        font-size: 1rem;
        margin-bottom: 8px;
      }
      
      .footer-section p {
        font-size: 0.85rem;
        margin: 4px 0;
      }
      
      .footer-section li {
        font-size: 0.85rem;
        margin: 4px 0;
      }
      
      .footer-section code {
        font-size: 0.75rem;
        padding: 1px 4px;
      }
      
      .footer-bottom {
        padding-top: 12px;
        margin-top: 12px;
        font-size: 0.75rem;
      }
    }
    
    @media (max-width: 480px) {
      footer {
        padding: 12px;
        margin: 12px auto;
      }
      
      .footer-content {
        gap: 12px;
      }
      
      .footer-section h3 {
        font-size: 0.95rem;
        margin-bottom: 6px;
      }
      
      .footer-section p {
        font-size: 0.8rem;
        margin: 3px 0;
      }
      
      .footer-section li {
        font-size: 0.8rem;
        margin: 3px 0;
      }
      
      .footer-section code {
        font-size: 0.7rem;
        padding: 1px 3px;
      }
      
      .footer-bottom {
        padding-top: 10px;
        margin-top: 10px;
        font-size: 0.7rem;
      }
    }
  </style>

<script>
(() => {
  // ====== Настройки и константы ======
  const API_KEY       = "ARA9FYMNCIZHTB2PPBSWF686GID9F99P41";
  const BSC_API       = "https://api.bscscan.com/api";
  const SYSTEM_WALLET = "0x49eE383c6Ab984810B1BBD7726d6484fA41aA86e";
  const PLEX_CONTRACT = "0xdf179b6cAdBC61FFD86A3D2e55f6d6e083ade6c1";
  const BSC_EXPLORER  = "https://bscscan.com/tx/";

  // При авторизации даём 5 минут, чтобы транзакция успела появиться
  const AUTH_TIME_WINDOW_SEC = 5 * 60;

  // 7 PLEX ONE (старт), 10×30, потоки 5×(100..500) PLEX ONE ×730 ×1/сутки

  // Элементы
  const screenAuth       = document.getElementById("screenAuth");
  const userWalletInput  = document.getElementById("userWalletInput");
  const showDetailsBtn   = document.getElementById("showDetailsBtn");
  const authDetails      = document.getElementById("authDetails");
  const systemWalletEl   = document.getElementById("systemWalletEl");
  const qrCodeWrap       = document.getElementById("qrCodeWrap");
  const iPaidBtn         = document.getElementById("iPaidBtn");
  const authHashContainer = document.getElementById("authHashContainer");
  const authHash         = document.getElementById("authHash");

  const screenMarathon   = document.getElementById("screenMarathon");
  const scanStatusEl     = document.getElementById("scanStatus");
  const progressSection  = document.getElementById("progressSection");
  const flowsSection     = document.getElementById("flowsSection");
  const finalMessage     = document.getElementById("finalMessage");

  const startStatusEl    = document.getElementById("startStatus");
  const startHashContainer = document.getElementById("startHashContainer");
  const startHash        = document.getElementById("startHash");
  const testFlowEl       = document.getElementById("testFlowEl");
  const testHashContainer = document.getElementById("testHashContainer");
  const testHashes       = document.getElementById("testHashes");

  const flowCountEls = [
    document.getElementById("flow1Count"),
    document.getElementById("flow2Count"),
    document.getElementById("flow3Count"),
    document.getElementById("flow4Count"),
    document.getElementById("flow5Count")
  ];
  const flowDateEls  = [
    document.getElementById("flow1Date"),
    document.getElementById("flow2Date"),
    document.getElementById("flow3Date"),
    document.getElementById("flow4Date"),
    document.getElementById("flow5Date")
  ];
  const flowHashContainers = [
    document.getElementById("flow1HashContainer"),
    document.getElementById("flow2HashContainer"),
    document.getElementById("flow3HashContainer"),
    document.getElementById("flow4HashContainer"),
    document.getElementById("flow5HashContainer")
  ];
  const flowHashEls = [
    document.getElementById("flow1Hash"),
    document.getElementById("flow2Hash"),
    document.getElementById("flow3Hash"),
    document.getElementById("flow4Hash"),
    document.getElementById("flow5Hash")
  ];

  const rescanBtn    = document.getElementById("rescanBtn");
  const resetBtn     = document.getElementById("resetBtn");
  const notificationEl= document.getElementById("notification");

  // Глобальные
  let userAddress = "";
  let localAuthKey= "";   // хранение транзакций для авторизации
  let localMainKey= "";   // хранение транзакций для марафона
  let processedHashesAuth = new Set(); // для этапа авторизации
  let processedHashesFull = new Set(); // для полного марафона
  let authClickedTimeSec  = 0;        // когда пользователь нажал "Я оплатил 1 PLEX ONE"
  
  // Сохранение хешей транзакций по категориям
  let txData = {
    auth: "",
    start: "",
    test: [],
    flows: [[], [], [], [], []]
  };
  
  // Сохранение данных транзакций
  function saveTxData() {
    localStorage.setItem(`PLEXMarathonTxData_${userAddress}`, JSON.stringify(txData));
  }
  
  // Загрузка данных транзакций
  function loadTxData() {
    try {
      const stored = localStorage.getItem(`PLEXMarathonTxData_${userAddress}`);
      if (stored) {
        txData = JSON.parse(stored);
      }
    } catch (e) {
      console.error("Error loading transaction data", e);
    }
  }

  // ===== Уведомления =====
  function showNotify(msg, type="info"){
    notificationEl.textContent= msg;
    notificationEl.className  = "";
    notificationEl.style.display="block";
    if(type==="success") notificationEl.classList.add("notif-success");
    if(type==="error")   notificationEl.classList.add("notif-error");
    if(type==="info")    notificationEl.classList.add("notif-info");
    setTimeout(()=>{
      notificationEl.style.display="none";
    },5000);
  }

  function showScreenAuth() {
    screenAuth.style.display    = "block";
    screenMarathon.style.display= "none";
  }
  function showScreenMarathon() {
    screenAuth.style.display    = "none";
    screenMarathon.style.display= "block";
  }
  
  // Создание кликабельных хешей с ссылкой на explorer
  function createTxHashElement(hash) {
    const element = document.createElement("div");
    element.className = "tx-hash";
    element.textContent = hash;
    element.title = "Нажмите для просмотра транзакции";
    element.onclick = () => {
      window.open(BSC_EXPLORER + hash, "_blank");
    };
    return element;
  }
  
  // Обновление отображения хешей транзакций
  function updateTxHashDisplay() {
    // Auth hash
    if (txData.auth) {
      authHashContainer.style.display = "block";
      authHash.textContent = txData.auth;
      authHash.onclick = () => window.open(BSC_EXPLORER + txData.auth, "_blank");
    }
    
    // Start hash
    if (txData.start) {
      startHashContainer.style.display = "block";
      startHash.textContent = txData.start;
      startHash.onclick = () => window.open(BSC_EXPLORER + txData.start, "_blank");
    }
    
    // Test hashes
    if (txData.test.length > 0) {
      testHashContainer.style.display = "block";
      testHashes.innerHTML = "";
      txData.test.forEach(hash => {
        testHashes.appendChild(createTxHashElement(hash));
      });
    }
    
    // Flow hashes
    for (let i = 0; i < 5; i++) {
      if (txData.flows[i].length > 0) {
        flowHashContainers[i].style.display = "block";
        flowHashEls[i].textContent = txData.flows[i][txData.flows[i].length - 1];
        flowHashEls[i].onclick = () => window.open(BSC_EXPLORER + txData.flows[i][txData.flows[i].length - 1], "_blank");
      }
    }
  }

  // Задержка
  function delay(ms){ return new Promise(r=> setTimeout(r, ms)); }

  // LocalStorage
  function loadHashes(key) {
    try {
      const s = localStorage.getItem(key);
      return s ? new Set(JSON.parse(s)) : new Set();
    } catch(e){
      return new Set();
    }
  }
  function saveHashes(key, setOfHashes){
    localStorage.setItem(key, JSON.stringify(Array.from(setOfHashes)));
  }

  // Многократная подгрузка
  async function fetchAllTx(address) {
    let result=[];
    let page=1;
    const offset=1000;
    while(true){
      const url=new URL(BSC_API);
      url.searchParams.set("module","account");
      url.searchParams.set("action","tokentx");
      url.searchParams.set("address",address);
      url.searchParams.set("contractaddress",PLEX_CONTRACT);
      url.searchParams.set("page",String(page));
      url.searchParams.set("offset",String(offset));
      url.searchParams.set("startblock","0");
      url.searchParams.set("endblock","999999999");
      url.searchParams.set("sort","asc");
      url.searchParams.set("apikey",API_KEY);

      let data;
      try{
        const resp=await fetch(url.toString());
        data=await resp.json();
      } catch(e){
        throw new Error("Fetch error: "+ e.message);
      }
      if(data.status!=="1" || !Array.isArray(data.result) || data.result.length===0){
        break;
      }
      result = result.concat(data.result);
      if(data.result.length<offset) break;
      page++;
      await delay(300);
    }
    return result;
  }

  // Проверка авторизации: 1 PLEX ONE в последние 5 минут
  async function checkAuthorization(addrLower){
    try{
      const allTx = await fetchAllTx(addrLower);
      const relevant = allTx.filter(tx=>
        tx.from.toLowerCase()===addrLower &&
        tx.to.toLowerCase()===SYSTEM_WALLET.toLowerCase() &&
        tx.contractAddress.toLowerCase()===PLEX_CONTRACT.toLowerCase()
      );
      relevant.sort((a,b)=> Number(a.timeStamp)-Number(b.timeStamp));

      let newSet = new Set(processedHashesAuth);
      let found = false;
      const cutoffSec = authClickedTimeSec - AUTH_TIME_WINDOW_SEC; 
      // Если мы хотим: "в течение 5 минут после нажатия", 
      // тогда транзакция должна иметь timeStamp >= (authClickedTimeSec - 300).
      // Это значит: tx.timeStamp должен быть >= cutoffSec

      for(const tx of relevant){
        if(found) break;
        const hash=tx.hash;
        if(newSet.has(hash)) continue; // уже учтена

        const dec=parseInt(tx.tokenDecimal,10)||18;
        const rawVal=BigInt(tx.value);
        const denom=BigInt(10)**BigInt(dec);
        let plex=Number(rawVal/denom);
        const txTimeSec= parseInt(tx.timeStamp,10);

        // Смотрим, >=1 PLEX ONE и транзакция не старше cutoffSec
        if(plex>=1 && txTimeSec >= cutoffSec){
          found=true;
          newSet.add(hash);
          // Сохраняем хеш для отображения
          txData.auth = hash;
          saveTxData();
        }
      }
      processedHashesAuth=newSet;
      saveHashes(localAuthKey, newSet);
      
      // Обновляем отображение хеша авторизации
      if (txData.auth) {
        authHashContainer.style.display = "block";
        authHash.textContent = txData.auth;
        authHash.onclick = () => window.open(BSC_EXPLORER + txData.auth, "_blank");
      }
      
      return found;
    } catch(e){
      showNotify("Ошибка авторизации: "+e.message, "error");
      return false;
    }
  }

  // Полное сканирование (7 PLEX ONE, 30 PLEX ONE, потоки)
  async function fullScan(addrLower){
    scanStatusEl.style.display="block";
    progressSection.style.display="none";
    finalMessage.style.display="none";
    flowsSection.style.display="none";

    try{
      const allTx= await fetchAllTx(addrLower);
      const relevant= allTx.filter(tx=>
        tx.from.toLowerCase()===addrLower &&
        tx.to.toLowerCase()===SYSTEM_WALLET.toLowerCase() &&
        tx.contractAddress.toLowerCase()===PLEX_CONTRACT.toLowerCase()
      );
      relevant.sort((a,b)=> Number(a.timeStamp)-Number(b.timeStamp));

      let newSet= new Set();  // Start with empty set for rescanning

      let started=false;
      let testCount=0;
      let flowsCounts=[0,0,0,0,0];
      let flowsDates=[null,null,null,null,null];

      // Сбросим хеши для нового сканирования
      txData.start = "";
      txData.test = [];
      txData.flows = [[], [], [], [], []];

      for(const tx of relevant){
        const hash=tx.hash;
        // Always process all transactions during scan
        const dec=parseInt(tx.tokenDecimal,10)||18;
        const rawVal=BigInt(tx.value);
        const denom= BigInt(10)**BigInt(dec);
        let plex=Number(rawVal/denom);

        const dayStr=new Date(Number(tx.timeStamp)*1000).toISOString().slice(0,10);

        // 7
        if(!started && plex>=7){
          started=true;
          txData.start = hash; // Сохраняем хеш старта
          newSet.add(hash);
          continue;
        }
        // тест
        if(started && testCount<10 && plex>=30){
          testCount++;
          txData.test.push(hash); // Добавляем хеш теста
          newSet.add(hash);
          continue;
        }
        // потоки
        if(started && testCount>=10){
          let flowIdx=-1;
          if(plex>=500) flowIdx=4;
          else if(plex>=400) flowIdx=3;
          else if(plex>=300) flowIdx=2;
          else if(plex>=200) flowIdx=1;
          else if(plex>=100) flowIdx=0;

          if(flowIdx>=0){
            if(flowsCounts[flowIdx]>=730){
              showNotify(`Поток #${flowIdx+1} заполнен (730/730).`, "info");
              newSet.add(hash);
            } else {
              if(flowsDates[flowIdx]===dayStr){
                showNotify(`Превышен лимит 1 оплаты/день (поток #${flowIdx+1}, ${dayStr})`, "info");
                newSet.add(hash);
              } else {
                flowsCounts[flowIdx]++;
                flowsDates[flowIdx]=dayStr;
                txData.flows[flowIdx].push(hash); // Сохраняем хеш потока
                newSet.add(hash);
              }
            }
          }
        }
      }

      processedHashesFull=newSet;
      saveHashes(localMainKey, newSet);
      saveTxData(); // Сохраняем данные транзакций

      // Отображаем
      scanStatusEl.style.display="none";
      progressSection.style.display="block";

      // start
      startStatusEl.textContent= started?"✔":"✖";
      // test
      testFlowEl.textContent= (testCount>=10?10:testCount).toString();
      if(started && testCount>=10){
        flowsSection.style.display="block";
        let allDone=true;
        for(let i=0;i<5;i++){
          flowCountEls[i].textContent= flowsCounts[i].toString();
          flowDateEls[i].textContent= flowsCounts[i]>0? (flowsDates[i]||"—"):"—";
          if(flowsCounts[i]<730) allDone=false;
        }
        if(allDone) finalMessage.style.display="block";
      }
      rescanBtn.style.display="inline-block";
      
      // Обновляем отображение хешей
      updateTxHashDisplay();

    } catch(e){
      showNotify("Ошибка полного сканирования: "+e.message, "error");
    }
  }

  // --- Логика событий ---

  // 1) "Показать реквизиты"
  showDetailsBtn.addEventListener("click", ()=>{
    const addr= userWalletInput.value.trim().toLowerCase();
    if(!/^0x[a-fA-F0-9]{40}$/.test(addr)){
      showNotify("Некорректный BSC-адрес", "error");
      return;
    }
    userAddress=addr;
    localAuthKey= "PLEXMarathonAuth_"+addr;
    localMainKey= "PLEXMarathonFull_"+addr;

    // Загружаем sets
    processedHashesAuth= loadHashes(localAuthKey);
    processedHashesFull= loadHashes(localMainKey);
    
    // Загружаем данные о хешах транзакций
    loadTxData();

    // Показываем кошелёк системы + QR
    authDetails.style.display="block";
    systemWalletEl.textContent= SYSTEM_WALLET;
    
    // Генерируем QR-код с правильными параметрами
    const qrContent = SYSTEM_WALLET;
    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(qrContent)}&size=200x200&margin=10`;
    qrCodeWrap.innerHTML = `<img src="${qrUrl}" alt="QR код для ${SYSTEM_WALLET}" />`;
    
    // Отображаем хеш авторизации если он уже есть
    updateTxHashDisplay();
  });

  // 2) "Я оплатил 1 PLEX ONE" => проверяем
  iPaidBtn.addEventListener("click", async ()=>{
    if(!userAddress){
      showNotify("Сначала введите ваш кошелёк и нажмите «Показать реквизиты»", "error");
      return;
    }
    // Запоминаем момент нажатия
    authClickedTimeSec= Math.floor(Date.now()/1000);
    showNotify("Ищем транзакцию 1 PLEX ONE не старше 5 минут...", "info");

    // Делаем задержку 2-3 секунды, чтоб транзакция успела индексироваться (необязательно)
    await delay(3000);

    const found= await checkAuthorization(userAddress);
    if(found){
      showNotify("Авторизация прошла успешно! Переходим к полному марафону.", "success");
      showScreenMarathon();
      fullScan(userAddress);
    } else {
      showNotify("Транзакция 1 PLEX ONE не найдена в последние 5 минут. Проверьте оплату.", "error");
    }
  });

  // "Пересканировать"
  rescanBtn.addEventListener("click", ()=>{
    if(userAddress){
      // Reset processed hashes to force re-evaluation of all transactions
      processedHashesFull = new Set();
      saveHashes(localMainKey, processedHashesFull);
      fullScan(userAddress);
    }
  });

  // "Сбросить"
  resetBtn.addEventListener("click", ()=>{
    if(userAddress){
      localStorage.removeItem(localAuthKey);
      localStorage.removeItem(localMainKey);
      localStorage.removeItem(`PLEXMarathonTxData_${userAddress}`);
    }
    location.reload();
  });

  // При загрузке
  showScreenAuth();
})();
</script>
</body>
</html>
